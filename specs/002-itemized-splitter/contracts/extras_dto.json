{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://expense-tracker.app/schemas/extras_dto.json",
  "title": "Extras Firestore DTO",
  "description": "Tax, tip, fees, and discounts applied to a receipt",
  "type": "object",
  "properties": {
    "tax": {
      "type": "object",
      "description": "Sales tax configuration (null if no tax)",
      "required": [],
      "properties": {
        "percentValue": {
          "type": "string",
          "description": "Tax percentage (0-100) as decimal string",
          "pattern": "^\\d+(\\.\\d+)?$",
          "examples": ["8.875", "6.5", "0"]
        },
        "absoluteValue": {
          "type": "string",
          "description": "Absolute tax amount as decimal string",
          "pattern": "^\\d+(\\.\\d+)?$",
          "examples": ["5.50", "10.00"]
        },
        "base": {
          "type": "string",
          "description": "What the percentage tax is calculated on (required if percentValue set)",
          "enum": [
            "preTaxItemSubtotals",
            "taxableItemSubtotalsOnly",
            "postDiscountItemSubtotals",
            "postTaxSubtotals",
            "postFeesSubtotals"
          ],
          "examples": ["preTaxItemSubtotals"]
        }
      },
      "oneOf": [
        {
          "required": ["percentValue", "base"]
        },
        {
          "required": ["absoluteValue"]
        }
      ],
      "examples": [
        {
          "percentValue": "8.875",
          "base": "preTaxItemSubtotals"
        },
        {
          "absoluteValue": "5.50"
        }
      ]
    },
    "tip": {
      "type": "object",
      "description": "Gratuity/tip configuration (null if no tip)",
      "required": [],
      "properties": {
        "percentValue": {
          "type": "string",
          "description": "Tip percentage (0-100) as decimal string",
          "pattern": "^\\d+(\\.\\d+)?$",
          "examples": ["18", "20", "15.5"]
        },
        "absoluteValue": {
          "type": "string",
          "description": "Absolute tip amount as decimal string",
          "pattern": "^\\d+(\\.\\d+)?$",
          "examples": ["10.00", "25.00"]
        },
        "base": {
          "type": "string",
          "description": "What the percentage tip is calculated on (required if percentValue set)",
          "enum": [
            "preTaxItemSubtotals",
            "taxableItemSubtotalsOnly",
            "postDiscountItemSubtotals",
            "postTaxSubtotals",
            "postFeesSubtotals"
          ],
          "examples": ["postTaxSubtotals"]
        }
      },
      "oneOf": [
        {
          "required": ["percentValue", "base"]
        },
        {
          "required": ["absoluteValue"]
        }
      ],
      "examples": [
        {
          "percentValue": "20",
          "base": "postTaxSubtotals"
        },
        {
          "absoluteValue": "15.00"
        }
      ]
    },
    "fees": {
      "type": "array",
      "description": "Additional fees (delivery, service charge, etc.)",
      "default": [],
      "items": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Fee description",
            "minLength": 1,
            "maxLength": 50,
            "examples": ["Delivery Fee", "Service Charge", "Processing Fee"]
          },
          "percentValue": {
            "type": "string",
            "description": "Fee as percentage (0-100)",
            "pattern": "^\\d+(\\.\\d+)?$",
            "examples": ["10", "5.5"]
          },
          "absoluteValue": {
            "type": "string",
            "description": "Fee as absolute amount",
            "pattern": "^\\d+(\\.\\d+)?$",
            "examples": ["5.00", "3.50"]
          },
          "percentBase": {
            "type": "string",
            "description": "Base for percentage fee (required if percentValue set)",
            "enum": [
              "preTaxItemSubtotals",
              "taxableItemSubtotalsOnly",
              "postDiscountItemSubtotals",
              "postTaxSubtotals",
              "postFeesSubtotals"
            ],
            "examples": ["preTaxItemSubtotals"]
          },
          "absoluteSplit": {
            "type": "string",
            "description": "How to split absolute fee (required if absoluteValue set)",
            "enum": [
              "evenAcrossAllParticipants",
              "proportionalToItemSubtotals"
            ],
            "examples": ["evenAcrossAllParticipants"]
          }
        },
        "oneOf": [
          {
            "required": ["percentValue", "percentBase"]
          },
          {
            "required": ["absoluteValue", "absoluteSplit"]
          }
        ]
      },
      "examples": [
        [
          {
            "name": "Delivery Fee",
            "absoluteValue": "5.00",
            "absoluteSplit": "evenAcrossAllParticipants"
          },
          {
            "name": "Service Charge",
            "percentValue": "10",
            "percentBase": "preTaxItemSubtotals"
          }
        ]
      ]
    },
    "discounts": {
      "type": "array",
      "description": "Coupons, promotions, discounts",
      "default": [],
      "items": {
        "type": "object",
        "required": ["name", "applyBeforeTax"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Discount description",
            "minLength": 1,
            "maxLength": 50,
            "examples": ["20% Off Happy Hour", "$10 Coupon", "BOGO Discount"]
          },
          "percentValue": {
            "type": "string",
            "description": "Discount as percentage (0-100)",
            "pattern": "^\\d+(\\.\\d+)?$",
            "examples": ["20", "15.5"]
          },
          "absoluteValue": {
            "type": "string",
            "description": "Discount as absolute amount",
            "pattern": "^\\d+(\\.\\d+)?$",
            "examples": ["10.00", "5.00"]
          },
          "percentBase": {
            "type": "string",
            "description": "Base for percentage discount (required if percentValue set)",
            "enum": [
              "preTaxItemSubtotals",
              "taxableItemSubtotalsOnly",
              "postDiscountItemSubtotals",
              "postTaxSubtotals",
              "postFeesSubtotals"
            ],
            "examples": ["preTaxItemSubtotals"]
          },
          "absoluteSplit": {
            "type": "string",
            "description": "How to split absolute discount (required if absoluteValue set)",
            "enum": [
              "evenAcrossAllParticipants",
              "proportionalToItemSubtotals"
            ],
            "examples": ["proportionalToItemSubtotals"]
          },
          "applyBeforeTax": {
            "type": "boolean",
            "description": "Whether discount applies before tax calculation",
            "default": true,
            "examples": [true, false]
          }
        },
        "oneOf": [
          {
            "required": ["percentValue", "percentBase"]
          },
          {
            "required": ["absoluteValue", "absoluteSplit"]
          }
        ]
      },
      "examples": [
        [
          {
            "name": "20% Off Happy Hour",
            "percentValue": "20",
            "percentBase": "preTaxItemSubtotals",
            "applyBeforeTax": true
          },
          {
            "name": "$10 Coupon",
            "absoluteValue": "10.00",
            "absoluteSplit": "proportionalToItemSubtotals",
            "applyBeforeTax": true
          }
        ]
      ]
    }
  },
  "examples": [
    {
      "tax": {
        "percentValue": "8.875",
        "base": "preTaxItemSubtotals"
      },
      "tip": {
        "percentValue": "20",
        "base": "postTaxSubtotals"
      },
      "fees": [
        {
          "name": "Delivery Fee",
          "absoluteValue": "5.00",
          "absoluteSplit": "evenAcrossAllParticipants"
        }
      ],
      "discounts": [
        {
          "name": "20% Off",
          "percentValue": "20",
          "percentBase": "preTaxItemSubtotals",
          "applyBeforeTax": true
        }
      ]
    },
    {
      "tax": {
        "absoluteValue": "6.50"
      },
      "tip": {
        "absoluteValue": "15.00"
      },
      "fees": [],
      "discounts": []
    },
    {
      "fees": [],
      "discounts": []
    }
  ]
}
